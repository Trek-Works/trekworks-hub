<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TrekWorks Hub</title>
<meta name="color-scheme" content="dark light" />
<style>
  :root{
    --bg:#0f1115; --panel:#151822; --panel-2:#101320; --text:#eaeef7; --muted:#9aa3b2;
    --accent:#4fb2ff; --accent-2:#6fdd9c; --divider:#1e2230;
    --card:#161a25; --card-hover:#1b2030;
    --pill:#0f1320; --pill-indicator:#243048;
    --radius:16px;
  }
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Helvetica,Arial,sans-serif;
    background:var(--bg); color:var(--text);
  }

  .wrap{max-width:1100px; margin:0 auto; padding:28px 16px 64px}
  header{display:flex; align-items:center; justify-content:center; margin-bottom:18px}
  header h1{font-weight:700; font-size:clamp(22px,3.2vw,36px); margin:0; letter-spacing:.2px}
  header .globe{font-size:28px; margin-right:10px}

  /* segmented control */
  .seg{
    position:relative; display:inline-grid; grid-auto-flow:column; gap:0;
    background:var(--pill); border:1px solid var(--divider);
    border-radius:999px; padding:6px; margin:8px auto 22px; user-select:none;
  }
  .seg button{
    position:relative; z-index:1; appearance:none; border:0; background:transparent;
    color:var(--muted); padding:10px 18px; border-radius:999px; font-weight:600; cursor:pointer;
    font-size:14px; letter-spacing:.2px;
  }
  .seg button[aria-pressed="true"]{color:var(--text)}
  .seg .indicator{
    position:absolute; top:6px; left:6px; height:calc(100% - 12px);
    width:calc(50% - 6px); border-radius:999px; background:var(--pill-indicator);
    transition:transform .28s cubic-bezier(.22,.61,.36,1);
  }
  .seg[data-mode="timeline"] .indicator{ transform:translateX(100%) }

  /* section headers */
  .section{margin:26px 0 8px}
  .section h2{
    font-size:18px; font-weight:700; margin:0 0 10px;
    display:flex; align-items:center; gap:10px;
  }
  .section .muted{color:var(--muted); font-weight:600}

  /* grid of trip cards */
  .grid{
    display:grid; gap:14px;
    grid-template-columns:repeat(auto-fill,minmax(250px,1fr));
  }

  .card{
    background:var(--card); border:1px solid var(--divider); border-radius:var(--radius);
    padding:16px 15px; transition:transform .12s ease, background .12s ease, border-color .12s ease;
    text-decoration:none; color:inherit; display:flex; flex-direction:column; gap:6px;
  }
  .card:hover{ transform:translateY(-2px); background:var(--card-hover); border-color:#26304a }
  .card .title{font-weight:700; font-size:16px; line-height:1.3}
  .meta{display:flex; gap:10px; align-items:center; color:var(--muted); font-size:13px}
  .pill{display:inline-flex; align-items:center; gap:6px; font-size:12px; color:var(--muted);
        background:var(--panel-2); padding:6px 10px; border-radius:999px; border:1px solid var(--divider)}
  .flag{font-size:16px}

  /* subtle divider */
  .divider{height:1px; background:var(--divider); margin:22px 0}

  /* small utilities */
  .sr-only{position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}

  @media (prefers-reduced-motion:reduce){
    *{transition:none!important; animation:none!important}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="globe">üåè</div>
      <h1>TrekWorks Hub</h1>
    </header>

    <!-- Segmented Slider -->
    <div class="seg" role="tablist" aria-label="View mode" data-mode="countries">
      <div class="indicator" aria-hidden="true"></div>
      <button id="tab-countries" role="tab" aria-selected="true" aria-pressed="true" tabindex="0">Countries</button>
      <button id="tab-timeline"  role="tab" aria-selected="false" aria-pressed="false" tabindex="-1">Timeline</button>
    </div>

    <main id="content" aria-live="polite"></main>
  </div>

<script>
/** ========= Data loading =========
 * Expected /trips.json at repo root.
 * Fallback data is embedded so the page never breaks.
 *
 * trips.json shape:
 * [
 *  { "id":"GJN-2026-May",
 *    "title":"GJN-2026 (Japan)",
 *    "country":"Japan",
 *    "flag":"üáØüáµ",
 *    "start":"2026-05-14",
 *    "end":"2026-05-29",
 *    "path":"/Japan/GJN-2026-May/"
 *  }
 * ]
 */
const FALLBACK = [
  {"id":"SP-2025-Aug_Sep","title":"SP-2025 (Japan)","country":"Japan","flag":"üáØüáµ","start":"2025-08-20","end":"2025-09-05","path":"/JP/SP-2025-Aug_Sep/"},
  {"id":"GJN-2024-Sep","title":"GJN-2024 (Thailand)","country":"Thailand","flag":"üáπüá≠","start":"2024-09-02","end":"2024-09-12","path":"/TH/GJN-2024-Sep/"},
  {"id":"GJN-2025-Sep","title":"GJN-2025 (South Korea)","country":"South Korea","flag":"üá∞üá∑","start":"2025-09-05","end":"2025-09-15","path":"/KR/GJN-2025-Sep/"},
  {"id":"GJN-2025-May","title":"GJN-2025 (Thailand)","country":"Thailand","flag":"üáπüá≠","start":"2025-05-10","end":"2025-05-20","path":"/TH/GJN-2025-May/"},
  {"id":"GJN-2026-May","title":"GJN-2026 (Japan)","country":"Japan","flag":"üáØüáµ","start":"2026-05-14","end":"2026-05-29","path":"/JP/GJN-2026-May/"}
];

async function loadTrips(){
  try{
    const res = await fetch('trips.json',{cache:'no-cache'});
    if(!res.ok) throw new Error('no trips.json');
    const data = await res.json();
    return Array.isArray(data) && data.length ? data : FALLBACK;
  }catch(e){ return FALLBACK; }
}

function byDateAsc(a,b){ return new Date(a.start) - new Date(b.start); }
function groupBy(arr, key){
  return arr.reduce((acc,it)=>{ (acc[it[key]] ??= []).push(it); return acc; }, {});
}

function el(tag, cls, html){
  const n = document.createElement(tag);
  if(cls) n.className = cls;
  if(html!=null) n.innerHTML = html;
  return n;
}

/** ========= Renderers ========= */
function renderCountries(trips){
  const root = document.createDocumentFragment();
  const groups = groupBy(trips, 'country');
  // stable order: Japan, Thailand, South Korea (then others alphabetically)
  const countryOrder = ['Japan','Thailand','South Korea'];
  const ordered = Object.keys(groups).sort((a,b)=>{
    const ia = countryOrder.indexOf(a), ib = countryOrder.indexOf(b);
    if(ia>-1 && ib>-1) return ia-ib;
    if(ia>-1) return -1; if(ib>-1) return 1;
    return a.localeCompare(b);
  });

  ordered.forEach(country=>{
    const section = el('section','section');
    const flag = groups[country][0]?.flag || 'üåç';
    section.appendChild(el('h2',null,`<span class="flag">${flag}</span> ${country}`));
    const grid = el('div','grid');
    groups[country].sort(byDateAsc).forEach(t=>{
      grid.appendChild(card(t));
    });
    section.appendChild(grid);
    root.appendChild(section);
    root.appendChild(el('div','divider'));
  });
  return root;
}

function renderTimeline(trips){
  const root = document.createDocumentFragment();
  const section = el('section','section');
  section.appendChild(el('h2',null,'üìÖ Timeline <span class="muted">(all trips)</span>'));
  const grid = el('div','grid');
  trips.slice().sort(byDateAsc).forEach(t=>{
    grid.appendChild(card(t,true));
  });
  section.appendChild(grid);
  root.appendChild(section);
  return root;
}

function fmtRange(t){
  try{
    const s = new Date(t.start), e = new Date(t.end);
    const opts = {day:'2-digit', month:'short', year:'numeric'};
    return `${s.toLocaleDateString(undefined,opts)} ‚Üí ${e.toLocaleDateString(undefined,opts)}`;
  }catch{ return '' }
}

function card(t, showCountryBadge=false){
  const a = el('a','card');
  a.href = t.path; // already domain-relative e.g. /Japan/GJN-2026-May/
  a.setAttribute('aria-label', `${t.title} (${t.country})`);
  const title = el('div','title', t.title);
  const meta = el('div','meta');
  meta.append(el('span',null,fmtRange(t)));
  if(showCountryBadge){
    const badge = el('span','pill',`<span class="flag">${t.flag || 'üåç'}</span>${t.country}`);
    meta.appendChild(badge);
  }
  a.append(title, meta);
  return a;
}

/** ========= Mode switching ========= */
function setMode(mode){
  const seg = document.querySelector('.seg');
  const btnCountries = document.getElementById('tab-countries');
  const btnTimeline  = document.getElementById('tab-timeline');
  seg.dataset.mode = mode;

  const countriesActive = mode==='countries';
  btnCountries.setAttribute('aria-selected', countriesActive);
  btnCountries.setAttribute('aria-pressed', countriesActive);
  btnCountries.tabIndex = countriesActive ? 0 : -1;

  btnTimeline.setAttribute('aria-selected', !countriesActive);
  btnTimeline.setAttribute('aria-pressed', !countriesActive);
  btnTimeline.tabIndex = countriesActive ? -1 : 0;
}

(async function init(){
  const trips = await loadTrips();
  const content = document.getElementById('content');

  // initial render (Countries)
  content.replaceChildren(renderCountries(trips));
  setMode('countries');

  const seg = document.querySelector('.seg');
  const btnCountries = document.getElementById('tab-countries');
  const btnTimeline  = document.getElementById('tab-timeline');

  function go(mode){
    setMode(mode);
    content.replaceChildren(mode==='countries' ? renderCountries(trips) : renderTimeline(trips));
    // make sure focus stays sensible
    (mode==='countries' ? btnCountries : btnTimeline).focus({preventScroll:true});
  }

  btnCountries.addEventListener('click', ()=> go('countries'));
  btnTimeline .addEventListener('click', ()=> go('timeline'));
  // keyboard support: left/right arrows move between tabs
  seg.addEventListener('keydown', e=>{
    if(e.key==='ArrowRight' || e.key==='ArrowLeft'){
      e.preventDefault();
      go(seg.dataset.mode==='countries' ? 'timeline' : 'countries');
    }
  });
})();
</script>
</body>
</html>
